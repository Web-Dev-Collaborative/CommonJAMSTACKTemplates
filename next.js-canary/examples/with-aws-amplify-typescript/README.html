<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="aws-amplify-and-typescript-with-nextjs">AWS Amplify and Typescript with NextJS</h1>
<p><a href="https://console.aws.amazon.com/amplify/home#/deploy?repo=https://github.com/vercel/next.js/tree/canary/examples/with-aws-amplify-typescript"><img src="https://oneclick.amplifyapp.com/button.svg" alt="amplifybutton" /></a></p>
<p>This example shows how to build a server rendered web application with NextJS and AWS Amplify. We use AWS Amplify to generate code and to manage and consume the AWS cloud resources needed for our app. The NextJS app has dynamic and static routes to demonstrate how to load data on the server based on the incoming request.</p>
<p>Two routes are implemented :</p>
<ul>
<li><p><code>/</code> : A server-rendered route that uses <code>getServersideProps</code> to load data from AppSync and renders it on the server (Code in <a href="src/pages/index.tsx">pages/index.tsx</a>)</p></li>
<li><p><code>/todo/[id]</code> : A dynamic route that uses <code>getStaticPaths</code>, <code>getStaticProps</code> and the id from the provided context to load a single todo from AppSync and render it on the server. (Code in <a href="src/pages/todo/%5Bid%5D.tsx">pages/todo/[id].tsx</a>)</p></li>
</ul>
<h2 id="how-to-use">How to use</h2>
<p>Execute <a href="https://github.com/vercel/next.js/tree/canary/packages/create-next-app"><code>create-next-app</code></a> with <a href="https://docs.npmjs.com/cli/init">npm</a> or <a href="https://yarnpkg.com/lang/en/docs/cli/create/">Yarn</a> to bootstrap the example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">npx</span> create-next-app --example with-aws-amplify-typescript nextjs-aws-amplify-typescript-app</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># or</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ex">yarn</span> create next-app --example with-aws-amplify-typescript nextjs-aws-amplify-typescript-app</a></code></pre></div>
<h3 id="initialize-and-deploy-the-amplify-project">Initialize and deploy the Amplify project</h3>
<details>
<p><summary>If you’ve never used amplify before </summary></p>
<h4 id="install-configure-amplify">Install &amp; Configure Amplify</h4>
<ol type="1">
<li><a href="https://portal.aws.amazon.com/billing/signup#/start">Sign up</a> for an AWS account</li>
<li>Install the AWS Amplify cli:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">npm</span> install -g @aws-amplify/cli</a></code></pre></div>
<ol start="3" type="1">
<li>Configure the Amplify cli</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">amplify</span> configure</a></code></pre></div>
<p><a href="https://aws-amplify.github.io/docs/cli-toolchain/quickstart?sdk=js">Read More</a></p>
</details>
<h4 id="initialize-amplify">Initialize Amplify</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1">$ <span class="ex">amplify</span> init</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co"># &lt;Interactive&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="ex">?</span> Enter a name for the project <span class="op">&lt;</span>PROJECT_NAME<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="ex">?</span> Enter a name for the environment: dev (or whatever you would like to call this env)</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="ex">?</span> Choose your default editor: <span class="op">&lt;</span>YOUR_EDITOR_OF_CHOICE<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="ex">?</span> Choose the type of app that you<span class="st">&#39;re building (Use arrow keys)</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">  android</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="st">  ios</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="st">❯ javascript</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="st">? What javascript framework are you using react</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="st">? Source Directory Path:  src</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="st">? Distribution Directory Path: build</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="st">? Build Command:  npm run build</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="st">? Start Command: npm run start</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="st">? Do you want to use an AWS profile? Y</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="st">? Select the authentication method you want to use: AWS Profile</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="st">? Please choose the profile you want to use: &lt;Your profile</span></a>
<a class="sourceLine" id="cb4-19" title="19"></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="st"># &lt;/Interactive&gt;</span></a></code></pre></div>
<h4 id="add-the-api-and-the-auth">Add the API and the Auth</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1">$ <span class="ex">amplify</span> add api</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># &lt;Interactive&gt;</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="ex">?</span> Please select from one of the below mentioned services (Use arrow keys)</a>
<a class="sourceLine" id="cb5-4" title="4">❯ <span class="ex">GraphQL</span></a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="ex">REST</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="ex">?</span> Provide API name: <span class="op">&lt;</span>API_NAME<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="ex">?</span> Choose the default authorization type for the API (Use arrow keys)</a>
<a class="sourceLine" id="cb5-8" title="8">❯ <span class="ex">API</span> key</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="ex">Amazon</span> Cognito User Pool</a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="ex">IAM</span></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="ex">OpenID</span> Connect</a>
<a class="sourceLine" id="cb5-12" title="12"><span class="ex">?</span> Enter a description for the API key: <span class="op">&lt;</span>API_DESCRIPTION<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="ex">?</span> After how many days from now the API key should expire (1-365)<span class="bu">:</span> 7</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="ex">?</span> Do you want to configure advanced settings for the GraphQL API:</a>
<a class="sourceLine" id="cb5-15" title="15">  <span class="ex">No</span>, I am done.</a>
<a class="sourceLine" id="cb5-16" title="16">❯ <span class="ex">Yes</span>, I want to make some additional changes.</a>
<a class="sourceLine" id="cb5-17" title="17"><span class="ex">?</span> Configure additional auth types? y</a>
<a class="sourceLine" id="cb5-18" title="18"><span class="ex">?</span> Choose the additional authorization types you want to configure for the API</a>
<a class="sourceLine" id="cb5-19" title="19">❯<span class="kw">(</span><span class="ex">*</span><span class="kw">)</span> <span class="ex">Amazon</span> Cognito User Pool</a>
<a class="sourceLine" id="cb5-20" title="20"> <span class="kw">(</span> <span class="kw">)</span> <span class="ex">IAM</span></a>
<a class="sourceLine" id="cb5-21" title="21"> <span class="kw">(</span> <span class="kw">)</span> <span class="ex">OpenID</span> Connect</a>
<a class="sourceLine" id="cb5-22" title="22"><span class="ex">Do</span> you want to use the default authentication and security configuration? (Use arrow keys)</a>
<a class="sourceLine" id="cb5-23" title="23">❯ <span class="ex">Default</span> configuration</a>
<a class="sourceLine" id="cb5-24" title="24">  <span class="ex">Default</span> configuration with Social Provider (Federation)</a>
<a class="sourceLine" id="cb5-25" title="25">  <span class="ex">Manual</span> configuration</a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="ex">I</span> want to learn more.</a>
<a class="sourceLine" id="cb5-27" title="27"><span class="ex">How</span> do you want users to be able to sign in? (Use arrow keys)</a>
<a class="sourceLine" id="cb5-28" title="28">  <span class="ex">Username</span></a>
<a class="sourceLine" id="cb5-29" title="29">❯ <span class="ex">Email</span></a>
<a class="sourceLine" id="cb5-30" title="30">  <span class="ex">Phone</span> Number</a>
<a class="sourceLine" id="cb5-31" title="31">  <span class="ex">Email</span> or Phone Number</a>
<a class="sourceLine" id="cb5-32" title="32">  <span class="ex">I</span> want to learn more.</a>
<a class="sourceLine" id="cb5-33" title="33"><span class="ex">Do</span> you want to configure advanced settings? (Use arrow keys)</a>
<a class="sourceLine" id="cb5-34" title="34">❯ <span class="ex">No</span>, I am done.</a>
<a class="sourceLine" id="cb5-35" title="35">  <span class="ex">Yes</span>, I want to make some additional changes.</a>
<a class="sourceLine" id="cb5-36" title="36"><span class="ex">?</span> Enable conflict detection? N</a>
<a class="sourceLine" id="cb5-37" title="37"><span class="ex">?</span> Do you have an annotated GraphQL schema? N</a>
<a class="sourceLine" id="cb5-38" title="38"><span class="ex">?</span> Choose a schema template: (Use arrow keys)</a>
<a class="sourceLine" id="cb5-39" title="39">❯ <span class="ex">Single</span> object with fields (e.g., “Todo” with ID, name, description)</a>
<a class="sourceLine" id="cb5-40" title="40">  <span class="ex">One-to-many</span> relationship (e.g., “Blogs” with “Posts” and “Comments”)</a>
<a class="sourceLine" id="cb5-41" title="41">  <span class="ex">Objects</span> with fine-grained access control (e.g., a project management app with owner-based authorization)</a>
<a class="sourceLine" id="cb5-42" title="42"><span class="ex">?</span> Do you want to edit the schema now? Y</a>
<a class="sourceLine" id="cb5-43" title="43"><span class="co"># &lt;/Interactive&gt;</span></a></code></pre></div>
<h4 id="edit-graphql-schema">Edit GraphQL Schema</h4>
<p>Open <a href="amplify/backend/api/nextjswithamplifyts/schema.graphql"><code>amplify/backend/api/nextjswithamplifyts/schema.graphql</code></a> and change it to the following:</p>
<pre><code>type Todo
  @model
  @auth(
    rules: [
      { allow: owner } # Allow the creator of a todo to perform Create, Update, Delete operations.
      { allow: public, operations: [read] } # Allow public (guest users without an account) to Read todos.
      { allow: private, operations: [read] } # Allow private (other signed in users) to Read todos.
    ]
  ) {
  id: ID!
  name: String!
  description: String
}
</code></pre>
<h4 id="deploy-infrastructure">Deploy infrastructure</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">amplify</span> push</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># &lt;Interactive&gt;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="ex">?</span> Are you sure you want to continue? Y</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="ex">?</span> Do you want to generate code for your newly created GraphQL API? Y</a>
<a class="sourceLine" id="cb7-5" title="5"><span class="ex">?</span> Choose the code generation language target (Use arrow keys)</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="ex">javascript</span></a>
<a class="sourceLine" id="cb7-7" title="7">❯ <span class="ex">typescript</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="ex">flow</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="ex">?</span> Enter the file name pattern of graphql queries, mutations and subscriptions (src/graphql/**/*.ts)</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="ex">?</span> Do you want to generate/update all possible GraphQL operations - queries, mutations and subscriptions (Y/n) <span class="ex">Y</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="ex">?</span> Enter maximum statement depth [increase from default if your schema is deeply nested] (2)</a>
<a class="sourceLine" id="cb7-12" title="12"><span class="ex">?</span> Enter the file name for the generated code: src\API.ts</a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co"># &lt;/Interactive&gt;</span></a></code></pre></div>
<h3 id="install-run">Install &amp; Run</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">npm</span> install</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ex">npm</span> run dev</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co"># or</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="ex">yarn</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="ex">yarn</span> dev</a></code></pre></div>
</body>
</html>
